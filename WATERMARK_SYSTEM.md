# نظام العلامة المائية المتطور - Q8 MAZAD SPORT

## نظرة عامة
تم تطوير نظام علامة مائية متقدم في موقع Q8 MAZAD SPORT لحماية شاملة لجميع الصور المرفوعة. النظام يتضمن:
1. **علامة مائية رئيسية**: نص واضح في موضع محدد
2. **خلفية مائية متكررة**: نص منتشر عبر كامل الصورة بشفافية منخفضة

## الميزات الرئيسية

### ✅ حماية مزدوجة الطبقات
- **الطبقة الأولى**: علامة مائية رئيسية واضحة
- **الطبقة الثانية**: خلفية مائية متكررة عبر كامل الصورة
- حماية فعالة ضد القص أو التلاعب بالصورة

### ✅ تصميم ذكي
- النص الخلفي يدور بزاوية 22.5 درجة لتوزيع أفضل
- مسافات محسوبة بدقة لتغطية كاملة
- شفافية متدرجة لا تؤثر على جودة الصورة الأصلية

### ✅ تخصيص تلقائي متقدم
- حجم النص يتناسب مع حجم الصورة
- كثافة الخلفية المائية حسب نوع الاستخدام
- ألوان متكيفة مع محتوى الصورة

## كيفية العمل

### 1. رفع الصور في الإعلانات
```
/admin/advertisements → إضافة إعلان جديد → رفع صورة
```
- يتم إضافة العلامة المائية تلقائياً
- رسالة تأكيد تظهر للمستخدم
- معاينة الصورة مع العلامة المائية

### 2. إعدادات العلامة المائية المتقدمة

#### العلامة الرئيسية - للإعلانات:
- **النص**: Q8 MAZAD SPORT
- **الحجم**: 20-32px (حسب حجم الصورة)
- **الموضع**: الزاوية اليمنى السفلى
- **الشفافية**: 80%
- **اللون**: أبيض مع ظل أسود

#### الخلفية المائية - للإعلانات:
- **النص**: Q8 MAZAD SPORT (متكرر)
- **الحجم**: 80% من حجم العلامة الرئيسية
- **التوزيع**: شبكة مائلة بزاوية 22.5 درجة
- **الشفافية**: 5-8% (شفافية منخفضة جداً)
- **التغطية**: كامل سطح الصورة
- **المسافات**: 80px أفقياً، 60px عمودياً

#### للاستخدامات المختلفة:
```typescript
// للإعلانات - حماية قصوى
advertisements: {
  text: 'Q8 MAZAD SPORT',
  fontSize: 28,
  opacity: 0.8,
  position: 'bottom-right',
  enableBackground: true,
  backgroundOpacity: 0.06
}

// لقطع الغيار - حماية متوسطة
carParts: {
  text: 'Q8 MAZAD SPORT',
  fontSize: 24,
  opacity: 0.7,
  position: 'bottom-left',
  enableBackground: true,
  backgroundOpacity: 0.04
}

// للملف الشخصي - حماية خفيفة
profile: {
  text: 'Q8 MAZAD SPORT',
  fontSize: 20,
  opacity: 0.6,
  position: 'center',
  enableBackground: true,
  backgroundOpacity: 0.03
}
```

## الملفات الأساسية

### `src/utils/imageWatermark.ts`
يحتوي على وظائف معالجة الصور المتقدمة:
- `addWatermarkToImage()` - إضافة علامة مائية مع خلفية اختيارية
- `addBackgroundWatermark()` - إضافة خلفية مائية متكررة
- `addWatermarkToImages()` - معالجة عدة صور
- `isImageFile()` - التحقق من نوع الملف

**الميزات الجديدة**:
- خلفية مائية متكررة بزاوية مائلة
- تحكم في شفافية الخلفية منفصلة
- حساب ذكي للمسافات والتوزيع

### `src/components/WatermarkImageUploader.tsx`
مكون React لرفع الصور مع العلامة المائية:
- واجهة سحب وإفلات
- معاينة فورية
- رسائل تنبيهية
- شريط تقدم

### `src/app/admin/advertisements/page.tsx`
صفحة إدارة الإعلانات مع نظام رفع الصور المحمي:
- تكامل مع نظام العلامة المائية
- رسائل توضيحية للمستخدم
- معالجة الأخطاء

## الاستخدام في أماكن أخرى

### استيراد الوظائف
```typescript
import { addWatermarkToImage, isImageFile } from '@/utils/imageWatermark';
```

### إضافة علامة مائية مع خلفية متكررة
```typescript
const watermarkedFile = await addWatermarkToImage(file, {
  text: 'Q8 MAZAD SPORT',
  fontSize: 24,
  opacity: 0.8,
  position: 'bottom-right',
  color: 'rgba(255, 255, 255, 0.9)',
  enableBackground: true,        // تفعيل الخلفية المائية
  backgroundOpacity: 0.06       // شفافية الخلفية (5-8%)
});
```

### تخصيص الخلفية المائية
```typescript
// خلفية قوية للإعلانات المهمة
backgroundOpacity: 0.08

// خلفية متوسطة للمحتوى العادي  
backgroundOpacity: 0.05

// خلفية خفيفة للصور الشخصية
backgroundOpacity: 0.03

// إيقاف الخلفية تماماً
enableBackground: false
```

### استخدام المكون الجاهز
```tsx
import WatermarkImageUploader from '@/components/WatermarkImageUploader';

<WatermarkImageUploader
  onImageSelected={(file, preview) => {
    // التعامل مع الصورة المحمية
  }}
  showWatermarkNotice={true}
/>
```

## التقنيات المستخدمة

### HTML5 Canvas API المتقدم
- **رسم متعدد الطبقات**: الصورة الأصلية + الخلفية المائية + العلامة الرئيسية
- **تحويلات هندسية**: تدوير النص بزاوية 22.5 درجة للتوزيع الأمثل
- **حساب المصفوفات**: توزيع النص في شبكة مائلة عبر كامل سطح الصورة
- **تطبيق الشفافية**: طبقات متعددة بمستويات شفافية مختلفة
- **تأثيرات الظل**: ظل خفيف للنص الخلفي لتحسين الوضوح

### خوارزميات التوزيع الذكي
- **حساب المسافات**: توزيع النص بناء على حجم الخط وأبعاد الصورة
- **تغطية كاملة**: ضمان وصول النص لجميع أجزاء الصورة حتى عند القص
- **تجنب التداخل**: حساب المسافات لمنع تراكب النصوص

### File API
- قراءة الملفات المرفوعة
- تحويل البيانات بين التنسيقات
- إنشاء ملفات جديدة بالعلامة المائية

### React & TypeScript
- مكونات قابلة للإعادة الاستخدام
- معالجة الحالة والأخطاء
- واجهة مستخدم تفاعلية

## الحماية والأمان

### ✅ معالجة من جانب العميل
- تتم المعالجة في المتصفح
- لا يتم إرسال الصور الأصلية للخادم
- خصوصية عالية للبيانات

### ✅ التحقق من نوع الملفات
- فقط ملفات الصور مقبولة
- فحص امتداد وتوقيع الملف
- حماية من الملفات الضارة

### ✅ حدود الحجم
- حد أقصى لحجم الملف (5MB)
- معالجة محسّنة للصور الكبيرة
- رسائل خطأ واضحة

## الإعدادات القابلة للتخصيص

### حجم النص
```typescript
fontSize: Math.min(Math.max(fileSize > 500000 ? 28 : 20, 16), 32)
```

### الموضع
- `bottom-right`: الزاوية اليمنى السفلى (افتراضي)
- `bottom-left`: الزاوية اليسرى السفلى
- `top-right`: الزاوية اليمنى العلوية
- `top-left`: الزاوية اليسرى العلوية
- `center`: وسط الصورة

### الألوان
- أبيض شفاف: `rgba(255, 255, 255, 0.9)`
- أسود شفاف: `rgba(0, 0, 0, 0.8)`
- ألوان مخصصة حسب الحاجة

## الدعم والتحديثات

### متوافق مع:
- ✅ جميع المتصفحات الحديثة
- ✅ الأجهزة المحمولة
- ✅ أجهزة سطح المكتب
- ✅ تنسيقات الصور الشائعة (JPG, PNG, GIF)

### التطوير المستقبلي:
- إضافة لوجو الشركة
- خيارات تخصيص أكثر
- ضغط الصور تلقائياً
- دعم ملفات PDF

---

**تم التطوير بواسطة فريق Q8 MAZAD SPORT**  
*جميع الحقوق محفوظة © 2025*